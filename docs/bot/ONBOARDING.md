# Telegram Bot Onboarding - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-12-19
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ Telegram –±–æ—Ç–∞ –¥–ª—è Ayda Run –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è:

1. **Flow 1 (–£—á–∞—Å—Ç–Ω–∏–∫)** - –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **Flow 2A/2B (–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è)** - –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –∫–ª—É–±/–≥—Ä—É–ø–ø—É –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é
3. **Flow 3 (–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä)** - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –Ω–æ–≤—ã–π –∫–ª—É–±

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ onboarding_handler.py      # Flow 1: –ë–∞–∑–æ–≤—ã–π –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ invitation_handler.py      # Flow 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ organizer_handler.py       # Flow 3: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ admin_notifications.py     # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º –æ –∑–∞—è–≤–∫–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py               # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ messages.py                # –¢–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ validators.py              # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
‚îÇ
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îú‚îÄ‚îÄ user_storage.py            # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ club_storage.py            # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–ª—É–±–∞–º–∏ –∏ –∑–∞—è–≤–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ group_storage.py           # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –≥—Ä—É–ø–ø–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ membership_storage.py      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–ª–µ–Ω—Å—Ç–≤–æ–º
‚îÇ
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ test_bot/
        ‚îî‚îÄ‚îÄ test_onboarding.py     # –¢–µ—Å—Ç—ã –≤—Å–µ—Ö flow
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ú–æ–¥–µ–ª–∏:**
- `User` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `Club` - –ö–ª—É–±—ã
- `Group` - –ì—Ä—É–ø–ø—ã –≤–Ω—É—Ç—Ä–∏ –∫–ª—É–±–æ–≤
- `Membership` - –°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-–∫–ª—É–±-–≥—Ä—É–ø–ø–∞
- `ClubRequest` - –ó–∞—è–≤–∫–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–æ–≤

---

## Flow 1: –£—á–∞—Å—Ç–Ω–∏–∫ (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)

### –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
```
/start
```

### –≠—Ç–∞–ø—ã

#### 1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (AWAITING_CONSENT)
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º Ayda Run.

**–ö–Ω–æ–ø–∫–∏:**
- ‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
- ‚ùå –û—Ç–∫–∞–∑–∞—Ç—å—Å—è

#### 2. –í—ã–±–æ—Ä —Å–ø–æ—Ä—Ç–æ–≤ (SELECTING_SPORTS)
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Ä—Ç—ã:**
- –ë–µ–≥ (running)
- –¢—Ä–µ–π–ª (trail)
- –õ—ã–∂–∏ (skiing)
- –í–µ–ª–æ—Å–∏–ø–µ–¥ (cycling)
- –¢—Ä–∏–∞—Ç–ª–æ–Ω (triathlon)
- –î—Ä—É–≥–æ–µ (other)

**–ö–Ω–æ–ø–∫–∏:**
- –ß–µ–∫–±–æ–∫—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ø–æ—Ä—Ç–∞
- "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" (–º–∏–Ω–∏–º—É–º 1 —Å–ø–æ—Ä—Ç)

#### 3. –í—ã–±–æ—Ä —Ä–æ–ª–∏ (SELECTING_ROLE)
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Å–≤–æ—é —Ä–æ–ª—å.

**–†–æ–ª–∏:**
- üèÉ –£—á–∞—Å—Ç–Ω–∏–∫ - –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º
- üìã –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä - —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±

#### 4. –ò–Ω—Ç—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (SHOWING_INTRO)
–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ö–Ω–æ–ø–∫–∞:**
- "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" (WebApp)

#### 5. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- `has_completed_onboarding = True`
- `preferred_sports` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ JSON
- `role` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
"–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ..."

---

## Flow 2A: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –∫–ª—É–±

### –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
```
/start club_<UUID>
```

### –°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –ø—Ä–µ–≤—å—é –∫–ª—É–±–∞**
   - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞
   - –û–ø–∏—Å–∞–Ω–∏–µ
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø

2. **–ü—Ä–æ—Ö–æ–¥–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Flow 1** (—Å–æ–≥–ª–∞—Å–∏–µ ‚Üí —Å–ø–æ—Ä—Ç—ã ‚Üí —Ä–æ–ª—å ‚Üí –∏–Ω—Ç—Ä–æ)

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ**
   - –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–ª—É–±
   - –†–æ–ª—å: `MEMBER`

### –°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. **–ö–æ—Ä–æ—Ç–∫–æ–µ –ø—Ä–µ–≤—å—é –∫–ª—É–±–∞**
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—É–±–µ
   - –ö–Ω–æ–ø–∫–∞ "–í—Å—Ç—É–ø–∏—Ç—å"

2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–ª—É–±
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –≤—Å—Ç—É–ø–ª–µ–Ω–∏–∏

---

## Flow 2B: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É

### –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
```
/start group_<UUID>
```

### –°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –ø—Ä–µ–≤—å—é –≥—Ä—É–ø–ø—ã**
   - –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
   - –û–ø–∏—Å–∞–Ω–∏–µ
   - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞ (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ)
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

2. **–ü—Ä–æ—Ö–æ–¥–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Flow 1**

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –≥—Ä—É–ø–ø—É
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª—É–± (–µ—Å–ª–∏ –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç)
   - –†–æ–ª—å: `MEMBER`

### –°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Flow 2A, –Ω–æ –¥–ª—è –≥—Ä—É–ø–ø—ã.

---

## Flow 3: –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –∫–ª—É–±–∞

### –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
–í—ã–±–æ—Ä —Ä–æ–ª–∏ "–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä" –≤ Flow 1.

### –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
1. üìã –£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å –∫–ª—É–±
2. üÜï –•–æ—á—É —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—É–±

### –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞ (ORG_NEW_CLUB)

–ú—É–ª—å—Ç–∏-—à–∞–≥–æ–≤–∞—è —Ñ–æ—Ä–º–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:

#### 1. –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞ (CLUB_NAME)
**–í–æ–ø—Ä–æ—Å:** "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–∞—à –∫–ª—É–±?"
**–í–∞–ª–∏–¥–∞—Ü–∏—è:** 3-255 —Å–∏–º–≤–æ–ª–æ–≤

#### 2. –û–ø–∏—Å–∞–Ω–∏–µ (CLUB_DESCRIPTION)
**–í–æ–ø—Ä–æ—Å:** "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –∫–ª—É–±–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
**–í–∞–ª–∏–¥–∞—Ü–∏—è:** –î–æ 1000 —Å–∏–º–≤–æ–ª–æ–≤ –∏–ª–∏ "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å"

#### 3. –í–∏–¥—ã —Å–ø–æ—Ä—Ç–∞ (CLUB_SPORTS)
**–í–æ–ø—Ä–æ—Å:** "–ö–∞–∫–∏–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã?"
**–§–æ—Ä–º–∞—Ç:** –ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–±–µ–≥, —Ç—Ä–µ–π–ª, –ª—ã–∂–∏")

#### 4. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (CLUB_MEMBERS_COUNT)
**–í–æ–ø—Ä–æ—Å:** "–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤?"
**–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ß–∏—Å–ª–æ > 0 –∏–ª–∏ "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å"

#### 5. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø (CLUB_GROUPS_COUNT)
**–í–æ–ø—Ä–æ—Å:** "–°–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø/–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ –∫–ª—É–±–µ?"
**–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ß–∏—Å–ª–æ ‚â• 0 –∏–ª–∏ "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å"

#### 6. Telegram –≥—Ä—É–ø–ø–∞ (CLUB_TELEGRAM)
**–í–æ–ø—Ä–æ—Å:** "–°—Å—ã–ª–∫–∞ –Ω–∞ Telegram –≥—Ä—É–ø–ø—É –∫–ª—É–±–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
**–í–∞–ª–∏–¥–∞—Ü–∏—è:** `https://t.me/...` –∏–ª–∏ "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å"

#### 7. –ö–æ–Ω—Ç–∞–∫—Ç (CLUB_CONTACT)
**–í–æ–ø—Ä–æ—Å:** "–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏"
**–§–æ—Ä–º–∞—Ç:** @username, –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ email

#### 8. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (CLUB_CONFIRM)
**–ü—Ä–µ–≤—å—é –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö:**
```
üìã –ù–∞–∑–≤–∞–Ω–∏–µ: Test Running Club
üìù –û–ø–∏—Å–∞–Ω–∏–µ: –ö–ª—É–± –¥–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –±–µ–≥–∞
üèÉ –°–ø–æ—Ä—Ç—ã: –±–µ–≥, —Ç—Ä–µ–π–ª
üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ~50
üìä –ì—Ä—É–ø–ø: 3
üí¨ Telegram: https://t.me/testclub
üìß –ö–æ–Ω—Ç–∞–∫—Ç: @admin
```

**–ö–Ω–æ–ø–∫–∏:**
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
- ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–∫–∏

1. **–°–æ–∑–¥–∞–Ω–∏–µ ClubRequest**
   - –°—Ç–∞—Ç—É—Å: `PENDING`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ `ADMIN_CHAT_ID`
   - Inline –∫–Ω–æ–ø–∫–∏: "–û–¥–æ–±—Ä–∏—Ç—å" / "–û—Ç–∫–ª–æ–Ω–∏—Ç—å"

3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**
   - "–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ"
   - –í—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å `MEMBER`

### –ê–¥–º–∏–Ω—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

**Callback –∫–Ω–æ–ø–∫–∏:**
- `approve_club_<request_id>` - –û–¥–æ–±—Ä–∏—Ç—å
- `reject_club_<request_id>` - –û—Ç–∫–ª–æ–Ω–∏—Ç—å

**–ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π `Club`
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å `ORGANIZER`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –≤–ª–∞–¥–µ–ª–µ—Ü –∫–ª—É–±–∞
4. –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏: `APPROVED`
5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–± –æ–¥–æ–±—Ä–µ–Ω–∏–∏

**–ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏:**
1. –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏: `REJECTED`
2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –ø—Ä–∏—á–∏–Ω–æ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö (Storage Layer)

### UserStorage

```python
from storage.user_storage import UserStorage

storage = UserStorage()

# –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user = storage.get_or_create_user(
    telegram_id=123456789,
    username="john_doe",
    first_name="John",
    last_name="Doe"
)

# –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ —Å–ø–æ—Ä—Ç—ã
user = storage.update_preferred_sports(user.id, ["running", "trail"])

# –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
user = storage.mark_onboarding_complete(user.id)

# –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å
user = storage.update_user_role(user.id, UserRole.ORGANIZER)
```

### ClubStorage

```python
from storage.club_storage import ClubStorage

storage = ClubStorage()

# –ü–æ–ª—É—á–∏—Ç—å –∫–ª—É–±
club = storage.get_club_by_id(club_id)

# –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–≤—å—é –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
preview = storage.get_club_preview(club_id)
# {
#     "name": "Running Club",
#     "description": "...",
#     "member_count": 50,
#     "groups_count": 3
# }

# –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
request = storage.create_club_request({
    "user_id": user.id,
    "name": "New Club",
    "description": "...",
    "sports": '["running", "trail"]',
    "members_count": 25,
})

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
pending = storage.get_pending_requests()
```

### GroupStorage

```python
from storage.group_storage import GroupStorage

storage = GroupStorage()

# –ü–æ–ª—É—á–∏—Ç—å –≥—Ä—É–ø–ø—É
group = storage.get_group_by_id(group_id)

# –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–≤—å—é
preview = storage.get_group_preview(group_id)
# {
#     "name": "Morning Runners",
#     "description": "...",
#     "member_count": 20,
#     "club_name": "Running Club"
# }
```

### MembershipStorage

```python
from storage.membership_storage import MembershipStorage

storage = MembershipStorage()

# –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–ª—É–±
membership = storage.add_member_to_club(user.id, club.id)

# –î–æ–±–∞–≤–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É
membership = storage.add_member_to_group(user.id, group.id)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–ª–µ–Ω—Å—Ç–≤–æ
is_member = storage.is_member_of_club(user.id, club.id)
is_member = storage.is_member_of_group(user.id, group.id)

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —á–ª–µ–Ω—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
memberships = storage.get_user_memberships(user.id)
```

---

## –£—Ç–∏–ª–∏—Ç—ã

### Keyboards (bot/keyboards.py)

```python
from bot.keyboards import (
    get_consent_keyboard,
    get_sports_selection_keyboard,
    get_role_selection_keyboard,
    get_club_invitation_keyboard,
    get_webapp_button,
)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
keyboard = get_consent_keyboard()
await update.message.reply_text("–¢–µ–∫—Å—Ç", reply_markup=keyboard)
```

### Messages (bot/messages.py)

```python
from bot.messages import (
    WELCOME_MESSAGE,
    SPORTS_SELECTION_MESSAGE,
    format_club_preview,
)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
preview_text = format_club_preview({
    "name": "Running Club",
    "description": "Best club",
    "member_count": 50,
    "groups_count": 3
})
```

### Validators (bot/validators.py)

```python
from bot.validators import (
    validate_club_name,
    validate_members_count,
    is_valid_telegram_link,
)

# –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª—É–±–∞
valid, message = validate_club_name("My Club")
if not valid:
    await update.message.reply_text(message)
    return

# –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
valid, count = validate_members_count("50")
if not valid:
    await update.message.reply_text("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ")
    return
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Environment Variables

```env
# Telegram Bot
BOT_TOKEN=your_bot_token_here
ADMIN_CHAT_ID=123456789

# WebApp
WEB_APP_URL=https://your-app.com
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ config.py

```python
from config import settings

# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ
bot_token = settings.bot_token
admin_chat_id = settings.admin_chat_id
web_app_url = settings.web_app_url
```

---

## –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Handlers

–í—Å–µ handlers —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ `api_server.py` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:

```python
# api_server.py

from bot.onboarding_handler import onboarding_conv_handler
from bot.invitation_handler import join_invitation_handlers
from bot.organizer_handler import organizer_conv_handler
from bot.admin_notifications import handle_admin_approval

# –í lifespan —Ñ—É–Ω–∫—Ü–∏–∏
bot_app = Application.builder().token(settings.bot_token).build()

# Flow 1: Onboarding
bot_app.add_handler(onboarding_conv_handler)

# Flow 2: Invitations
for handler in join_invitation_handlers:
    bot_app.add_handler(handler)

# Flow 3: Organizer
bot_app.add_handler(organizer_conv_handler)

# Admin handlers
bot_app.add_handler(
    CallbackQueryHandler(
        lambda update, context: handle_admin_approval(context.bot, update.callback_query),
        pattern="^(approve_club_|reject_club_)"
    )
)
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
pytest tests/test_bot/test_onboarding.py -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/test_bot/test_onboarding.py::TestFlow1ParticipantOnboarding::test_start_onboarding_new_user -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/test_bot/test_onboarding.py --cov=bot --cov-report=html
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

- ‚úÖ Flow 1: –ë–∞–∑–æ–≤—ã–π –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- ‚úÖ Flow 2A: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –∫–ª—É–±
- ‚úÖ Flow 2B: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
- ‚úÖ Flow 3: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º
- ‚úÖ Storage –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `/start`
2. –ë–æ—Ç: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí –∫–Ω–æ–ø–∫–∞ "–ü—Ä–∏–Ω—è—Ç—å"
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü—Ä–∏–Ω—è—Ç—å
4. –ë–æ—Ç: –í—ã–±–æ—Ä —Å–ø–æ—Ä—Ç–æ–≤
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í—ã–±–∏—Ä–∞–µ—Ç "–ë–µ–≥", "–¢—Ä–µ–π–ª" ‚Üí "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
6. –ë–æ—Ç: –í—ã–±–æ—Ä —Ä–æ–ª–∏
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–£—á–∞—Å—Ç–Ω–∏–∫"
8. –ë–æ—Ç: –ò–Ω—Ç—Ä–æ ‚Üí –∫–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
9. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç WebApp
10. ‚úÖ –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∑–∞–≤–µ—Ä—à—ë–Ω

### –ü—Ä–∏–º–µ—Ä 2: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –∫–ª—É–± (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç: `https://t.me/yourbot?start=club_abc123`
2. –ë–æ—Ç: –ü—Ä–µ–≤—å—é –∫–ª—É–±–∞ "Running Club" + –æ–±—ã—á–Ω—ã–π Flow 1
3. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
4. –ë–æ—Ç: "–í—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–ª—É–± Running Club!"
5. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–ª—É–±–µ

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –∫–ª—É–± (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `/start club_abc123`
2. –ë–æ—Ç: –ü—Ä–µ–≤—å—é –∫–ª—É–±–∞ + –∫–Ω–æ–ø–∫–∞ "–í—Å—Ç—É–ø–∏—Ç—å"
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–í—Å—Ç—É–ø–∏—Ç—å"
4. –ë–æ—Ç: "–í—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–ª—É–± Running Club!"
5. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–ª—É–±–µ

### –ü—Ä–∏–º–µ—Ä 4: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `/start`
2. –ü—Ä–æ—Ö–æ–¥–∏—Ç Flow 1, –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–æ–ª—å "–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä"
3. –ë–æ—Ç: "–£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å –∫–ª—É–±" –∏–ª–∏ "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π"
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π"
5. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É:
   - –ù–∞–∑–≤–∞–Ω–∏–µ: "Trail Runners Moscow"
   - –û–ø–∏—Å–∞–Ω–∏–µ: "–ö–ª—É–± –¥–ª—è —Ç—Ä–µ–π–ª—Ä–∞–Ω–Ω–µ—Ä–æ–≤ –ú–æ—Å–∫–≤—ã"
   - –°–ø–æ—Ä—Ç—ã: "—Ç—Ä–µ–π–ª, –±–µ–≥"
   - –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: 30
   - –ì—Ä—É–ø–ø: 2
   - Telegram: https://t.me/trailrunmoscow
   - –ö–æ–Ω—Ç–∞–∫—Ç: @admin
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É"
7. –ë–æ—Ç ‚Üí –ê–¥–º–∏–Ω—É: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ + –∫–Ω–æ–ø–∫–∏
8. –ê–¥–º–∏–Ω: "–û–¥–æ–±—Ä–∏—Ç—å"
9. –ë–æ—Ç ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "–í–∞—à –∫–ª—É–± –æ–¥–æ–±—Ä–µ–Ω!"
10. ‚úÖ –ö–ª—É–± —Å–æ–∑–¥–∞–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä

---

## –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FLOW 1: PARTICIPANT                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    /start
      ‚Üì
[AWAITING_CONSENT] ‚Üí consent_accept
      ‚Üì
[SELECTING_SPORTS] ‚Üí sport_* (multiple)
      ‚Üì
[SELECTING_ROLE] ‚Üí role_participant
      ‚Üì
[SHOWING_INTRO] ‚Üí intro_done
      ‚Üì
    [END]


‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               FLOW 2: INVITATION (–Ω–æ–≤—ã–π)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    /start club_UUID
      ‚Üì
[Show Preview + AWAITING_CONSENT]
      ‚Üì
    [Same as Flow 1]
      ‚Üì
[Auto-join club on complete_onboarding]
      ‚Üì
    [END]


‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            FLOW 2: INVITATION (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    /start club_UUID
      ‚Üì
[Show Preview] ‚Üí join_club_UUID
      ‚Üì
[Add to membership]
      ‚Üì
    [END]


‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  FLOW 3: ORGANIZER                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
[SELECTING_ROLE] ‚Üí role_organizer
      ‚Üì
[ORG_CHOICE] ‚Üí org_new_club
      ‚Üì
[CLUB_NAME] ‚Üí (text input)
      ‚Üì
[CLUB_DESCRIPTION] ‚Üí (text input)
      ‚Üì
[CLUB_SPORTS] ‚Üí (text input)
      ‚Üì
[CLUB_MEMBERS_COUNT] ‚Üí (number input)
      ‚Üì
[CLUB_GROUPS_COUNT] ‚Üí (number input)
      ‚Üì
[CLUB_TELEGRAM] ‚Üí (link input)
      ‚Üì
[CLUB_CONTACT] ‚Üí (text input)
      ‚Üì
[CLUB_CONFIRM] ‚Üí confirm_club
      ‚Üì
[Create ClubRequest + Notify Admin]
      ‚Üì
    [END]
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `APP_URL` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ HTTPS
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ `BOT_TOKEN`
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `tail -f app.log`

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–ª—É–±

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –ë–î
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—É–± —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: `ClubStorage.get_club_by_id(club_id)`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ invitation_id —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ `context.user_data`

### –ü—Ä–æ–±–ª–µ–º–∞: –ê–¥–º–∏–Ω –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `ADMIN_CHAT_ID` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–¥–º–∏–Ω –∑–∞–ø—É—Å—Ç–∏–ª –±–æ—Ç–∞ (`/start`)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞: ConversationHandler –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–∞–∂–¥—ã–π handler –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π state
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ fallback handlers –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `conversation_timeout` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 300 —Å–µ–∫)

---

## Roadmap

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (Phase 0-3)
- Storage Layer
- Flow 1: Participant onboarding
- Flow 2: Invitations (club/group)
- Flow 3: Organizer club creation
- Admin notifications

### üîÑ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (Phase 4)
- End-to-end —Ç–µ—Å—Ç—ã
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å (i18n)
- Webhook retry –º–µ—Ö–∞–Ω–∏–∑–º

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: `docs/next_steps/ONBOARDING_IMPLEMENTATION_PLAN.md`
- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: `docs/next_steps/ayda-run-bot-onboarding-spec-v2.md`

**–ö–æ–¥:**
- Bot handlers: `bot/`
- Storage: `storage/`
- Tests: `tests/test_bot/`

**–í–æ–ø—Ä–æ—Å—ã:**
–°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-19
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
