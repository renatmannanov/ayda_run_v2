# Техническое задание: Онбординг пользователей через Telegram бота Ayda Run

## Общая информация

**Продукт:** Ayda Run — Telegram Mini App для управления спортивными сообществами

**Цель онбординга:** Классифицировать пользователя и провести его по соответствующему flow в зависимости от роли (участник vs организатор) и способа входа (самостоятельно vs по приглашению)

**Бот:** @ayda_run_v2_bot

---

## Архитектура онбординга

### Матрица классификации пользователей

```
┌─────────────────────────────────────────────────────────────────┐
│                    ПЕРВОЕ ВЗАИМОДЕЙСТВИЕ                        │
│                         /start                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Есть deep link параметр?                                      │
│           │                                                     │
│     ┌─────┴─────┐                                               │
│     │           │                                               │
│    Да          Нет                                              │
│     │           │                                               │
│     ▼           ▼                                               │
│  Парсим      Показываем                                         │
│  параметр    меню выбора                                        │
│     │        роли                                               │
│     │           │                                               │
│  ┌──┴──┐  ┌─────┴─────┐                                         │
│  │     │  │           │                                         │
│ club group Участник  Организатор                                │
│  │     │  │           │                                         │
│  ▼     ▼  ▼           ▼                                         │
│[2A]  [2B] [Flow 1]  [Flow 3]                                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## FLOW 1: Участник — самостоятельный вход

### Сценарий
Пользователь нашёл бота самостоятельно (поиск, рекомендация друга, реклама). Хочет найти где побегать/потренироваться.

### Алгоритм

```
ШАГИ FLOW 1 (Участник самостоятельно):

1. Пользователь отправляет /start (без параметров)

2. Бот проверяет: есть ли пользователь в БД?
   └── Да → "С возвращением, {firstName}!" → Показать главное меню
   └── Нет → Продолжаем онбординг

3. Бот отправляет приветственное сообщение:
   ┌────────────────────────────────────────────┐
   │ Привет, {firstName}! 👋                    │
   │                                            │
   │ Ayda Run — это приложение для              │
   │ спортивных сообществ Алматы.               │
   │                                            │
   │ Здесь ты можешь:                           │
   │ 🏃 Найти тренировки и пробежки             │
   │ 👥 Присоединиться к беговым клубам         │
   │ 📅 Записываться в один клик                │
   │                                            │
   │ Кто ты?                                    │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────┬─────────────────────┐
   │ 🏃 Хочу тренироваться│ 📋 Я организатор   │
   └─────────────────────┴─────────────────────┘

4. ЕСЛИ пользователь выбрал "Хочу тренироваться":

5. Бот отправляет запрос согласия:
   ┌────────────────────────────────────────────┐
   │ Отлично! 💪                                │
   │                                            │
   │ Для регистрации я использую твои данные    │
   │ из Telegram: имя и @username.              │
   │                                            │
   │ Это нужно, чтобы организаторы видели       │
   │ кто записался на тренировку.               │
   │                                            │
   │ Всё ок?                                    │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────┬─────────────────────┐
   │ ✅ Да, погнали!     │ ❌ Нет, не хочу     │
   └─────────────────────┴─────────────────────┘

6a. ЕСЛИ "Да, погнали!":

7. Бот спрашивает про виды активностей:
   ┌────────────────────────────────────────────┐
   │ Чем занимаешься? 🤔                        │
   │                                            │
   │ Выбери виды активностей, которые тебе      │
   │ интересны (можно несколько):               │
   └────────────────────────────────────────────┘
   
   [Inline keyboard с multi-select:]
   ┌───────────────────┬───────────────────┐
   │ ☐ 🏃 Бег          │ ☐ ⛰️ Трейл        │
   ├───────────────────┼───────────────────┤
   │ ☐ 🥾 Хайкинг      │ ☐ 🚴 Вело         │
   ├───────────────────┴───────────────────┤
   │            ✅ Готово                   │
   ├───────────────────────────────────────┤
   │            ⏭ Пропустить               │
   └───────────────────────────────────────┘
   
   ПРИМЕЧАНИЕ: При выборе галочка меняется на ☑️
   Можно выбрать несколько или пропустить

8. После выбора активностей — интро по приложению:
   
   [Бот отправляет КАРТИНКУ с главным экраном приложения]
   ┌────────────────────────────────────────────┐
   │ 📱 Как устроено приложение:                │
   │                                            │
   │ 🏠 Главная — тут ты найдёшь свои           │
   │ тренировки и открытые активности           │
   │                                            │
   │ 👥 Сообщества — тут клубы и группы,        │
   │ к которым можно присоединиться             │
   │                                            │
   │ 👤 Профиль — твоя страница                 │
   │ с историей и настройками                   │
   │                                            │
   │ ➕ Создать — можешь создать свои            │
   │ тренировки, клуб или группу                │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │              ▶️ Далее                        │
   └─────────────────────────────────────────────┘

9. Финальный экран:
   ┌────────────────────────────────────────────┐
   │ Готово! 🎉                                 │
   │                                            │
   │ Ты зарегистрирован как {firstName}         │
   │ (@{username})                              │
   │                                            │
   │ Теперь открой приложение и найди           │
   │ ближайшую тренировку!                      │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │         🚀 Открыть Ayda Run                 │
   │         (webapp button)                     │
   └─────────────────────────────────────────────┘

6b. ЕСЛИ "Нет, не хочу" (на шаге 5):

   ┌────────────────────────────────────────────┐
   │ Понял! Без проблем 😊                      │
   │                                            │
   │ Если передумаешь — просто напиши /start    │
   │                                            │
   │ Всегда рады тебя видеть! 👋                │
   └────────────────────────────────────────────┘
   
   [Конец flow]
```

---

## FLOW 2A: Участник — приглашение в клуб

### Сценарий
Пользователь перешёл по invite-ссылке в клуб (организация, объединяющая несколько групп).

### Алгоритм

```
ШАГИ FLOW 2A (Приглашение в клуб):

1. Пользователь переходит по ссылке приглашения в клуб

2. Бот парсит параметр и запрашивает данные о клубе

3. Бот проверяет: есть ли пользователь в БД?
   └── Да → Переход к шагу 8 (существующий пользователь)
   └── Нет → Продолжаем онбординг нового пользователя

4. Приветствие + информация о приложении И клубе:
   ┌────────────────────────────────────────────┐
   │ Привет, {firstName}! 👋                    │
   │                                            │
   │ Тебя пригласили в клуб:                    │
   │                                            │
   │ ┌────────────────────────────────────────┐ │
   │ │ 🏆 SRG Almaty                          │ │
   │ │ 80 участников · 3 группы               │ │
   │ │                                        │ │
   │ │ Беговой клуб Алматы. Тренировки       │ │
   │ │ каждый день: трейлы, шоссе, горы.     │ │
   │ └────────────────────────────────────────┘ │
   │                                            │
   │ Ayda Run — это приложение для спортивных   │
   │ сообществ, где ты сможешь:                 │
   │ 🏃 Видеть расписание тренировок            │
   │ 📅 Записываться в один клик                │
   │ 👥 Общаться с единомышленниками            │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │              ▶️ Далее                        │
   └─────────────────────────────────────────────┘

5. Запрос согласия на данные:
   ┌────────────────────────────────────────────┐
   │ Для вступления в клуб я использую твои     │
   │ данные из Telegram: имя и @username.       │
   │                                            │
   │ Это нужно, чтобы организаторы видели       │
   │ кто записался на тренировку.               │
   │                                            │
   │ Продолжаем?                                │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────┬─────────────────────┐
   │ ✅ Да, вступаю!     │ ❌ Не сейчас        │
   └─────────────────────┴─────────────────────┘

6. ЕСЛИ "Да, вступаю!" — спрашиваем про активности:
   ┌────────────────────────────────────────────┐
   │ Чем занимаешься? 🤔                        │
   │                                            │
   │ Выбери виды активностей:                   │
   └────────────────────────────────────────────┘
   
   [Inline keyboard с multi-select:]
   ┌───────────────────┬───────────────────┐
   │ ☐ 🏃 Бег          │ ☐ ⛰️ Трейл        │
   ├───────────────────┼───────────────────┤
   │ ☐ 🥾 Хайкинг      │ ☐ 🚴 Вело         │
   ├───────────────────┴───────────────────┤
   │            ✅ Готово                   │
   ├───────────────────────────────────────┤
   │            ⏭ Пропустить               │
   └───────────────────────────────────────┘

7. Интро по приложению + финал:
   
   [Бот отправляет КАРТИНКУ с главным экраном приложения]
   ┌────────────────────────────────────────────┐
   │ 📱 Как устроено приложение:                │
   │                                            │
   │ 🏠 Главная — тут ты найдёшь свои           │
   │ тренировки и открытые активности           │
   │                                            │
   │ 👥 Сообщества — тут клубы и группы         │
   │                                            │
   │ 👤 Профиль — твоя страница                 │
   │                                            │
   │ ➕ Создать — свои тренировки и группы       │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │              ▶️ Далее                        │
   └─────────────────────────────────────────────┘

   После нажатия:
   ┌────────────────────────────────────────────┐
   │ Добро пожаловать в SRG Almaty! 🎉          │
   │                                            │
   │ Ты теперь участник клуба.                  │
   │                                            │
   │ Открой приложение, чтобы увидеть           │
   │ расписание тренировок и записаться.        │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │     🚀 Открыть SRG Almaty в Ayda Run        │
   │         (webapp button)                     │
   └─────────────────────────────────────────────┘

8. ЕСЛИ пользователь УЖЕ СУЩЕСТВУЕТ в БД:
   ┌────────────────────────────────────────────┐
   │ С возвращением, {firstName}! 👋            │
   │                                            │
   │ Тебя пригласили в клуб:                    │
   │                                            │
   │ ┌────────────────────────────────────────┐ │
   │ │ 🏆 SRG Almaty                          │ │
   │ │ 80 участников · 3 группы               │ │
   │ │                                        │ │
   │ │ Беговой клуб Алматы. Тренировки       │ │
   │ │ каждый день: трейлы, шоссе, горы.     │ │
   │ └────────────────────────────────────────┘ │
   │                                            │
   │ Присоединяешься?                           │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────┬─────────────────────┐
   │ ✅ Вступить         │ ❌ Не сейчас        │
   └─────────────────────┴─────────────────────┘

9. ЕСЛИ существующий пользователь нажал "Вступить":
   ┌────────────────────────────────────────────┐
   │ Добро пожаловать в SRG Almaty! 🎉          │
   │                                            │
   │ Ты теперь участник клуба.                  │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │     🚀 Открыть SRG Almaty в Ayda Run        │
   └─────────────────────────────────────────────┘

10. ЕСЛИ "Не сейчас" (на любом шаге):
   ┌────────────────────────────────────────────┐
   │ Хорошо! Ссылка будет работать,             │
   │ когда решишь присоединиться.               │
   │                                            │
   │ Или можешь посмотреть публичные            │
   │ тренировки в приложении 👇                 │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │         🔍 Посмотреть тренировки            │
   └─────────────────────────────────────────────┘
```

---

## FLOW 2B: Участник — приглашение в группу

### Сценарий
Пользователь перешёл по invite-ссылке в группу (может быть частью клуба или независимой).

### Алгоритм

```
ШАГИ FLOW 2B (Приглашение в группу):

1. Пользователь переходит по ссылке приглашения в группу

2. Бот парсит параметр и запрашивает данные о группе
   ПРИМЕЧАНИЕ: Если группа внутри клуба — показываем и клуб тоже

3. Бот проверяет: есть ли пользователь в БД?
   └── Да → Переход к шагу 8 (существующий пользователь)
   └── Нет → Продолжаем онбординг нового пользователя

4. Приветствие + информация о приложении И группе:

   [Вариант A: Группа внутри клуба]
   ┌────────────────────────────────────────────┐
   │ Привет, {firstName}! 👋                    │
   │                                            │
   │ Тебя пригласили в группу:                  │
   │                                            │
   │ ┌────────────────────────────────────────┐ │
   │ │ 👥 Горные бегуны                       │ │
   │ │ 25 участников                          │ │
   │ │ Часть клуба: 🏆 SRG Almaty             │ │
   │ │                                        │ │
   │ │ Трейлы по выходным. Медеу,            │ │
   │ │ Шымбулак, Бутаковка.                  │ │
   │ └────────────────────────────────────────┘ │
   │                                            │
   │ Ayda Run — это приложение для спортивных   │
   │ сообществ, где ты сможешь:                 │
   │ 🏃 Видеть расписание тренировок            │
   │ 📅 Записываться в один клик                │
   │ 👥 Общаться с единомышленниками            │
   └────────────────────────────────────────────┘

   [Вариант B: Независимая группа]
   ┌────────────────────────────────────────────┐
   │ Привет, {firstName}! 👋                    │
   │                                            │
   │ Тебя пригласили в группу:                  │
   │                                            │
   │ ┌────────────────────────────────────────┐ │
   │ │ 👥 Вечерние бегуны                     │ │
   │ │ 15 участников                          │ │
   │ │                                        │ │
   │ │ Бегаем по вечерам в парке Первого     │ │
   │ │ Президента. Старт в 19:00.            │ │
   │ └────────────────────────────────────────┘ │
   │                                            │
   │ Ayda Run — это приложение для спортивных   │
   │ сообществ, где ты сможешь:                 │
   │ 🏃 Видеть расписание тренировок            │
   │ 📅 Записываться в один клик                │
   │ 👥 Общаться с единомышленниками            │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │              ▶️ Далее                        │
   └─────────────────────────────────────────────┘

5. Запрос согласия на данные:
   ┌────────────────────────────────────────────┐
   │ Для вступления в группу я использую твои   │
   │ данные из Telegram: имя и @username.       │
   │                                            │
   │ Это нужно, чтобы организаторы видели       │
   │ кто записался на тренировку.               │
   │                                            │
   │ Продолжаем?                                │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────┬─────────────────────┐
   │ ✅ Да, вступаю!     │ ❌ Не сейчас        │
   └─────────────────────┴─────────────────────┘

6. ЕСЛИ "Да, вступаю!" — спрашиваем про активности:
   ┌────────────────────────────────────────────┐
   │ Чем занимаешься? 🤔                        │
   │                                            │
   │ Выбери виды активностей:                   │
   └────────────────────────────────────────────┘
   
   [Inline keyboard с multi-select:]
   ┌───────────────────┬───────────────────┐
   │ ☐ 🏃 Бег          │ ☐ ⛰️ Трейл        │
   ├───────────────────┼───────────────────┤
   │ ☐ 🥾 Хайкинг      │ ☐ 🚴 Вело         │
   ├───────────────────┴───────────────────┤
   │            ✅ Готово                   │
   ├───────────────────────────────────────┤
   │            ⏭ Пропустить               │
   └───────────────────────────────────────┘

7. Интро по приложению + финал:
   
   [Бот отправляет КАРТИНКУ с главным экраном приложения]
   ┌────────────────────────────────────────────┐
   │ 📱 Как устроено приложение:                │
   │                                            │
   │ 🏠 Главная — тут ты найдёшь свои           │
   │ тренировки и открытые активности           │
   │                                            │
   │ 👥 Сообщества — тут клубы и группы         │
   │                                            │
   │ 👤 Профиль — твоя страница                 │
   │                                            │
   │ ➕ Создать — свои тренировки и группы       │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │              ▶️ Далее                        │
   └─────────────────────────────────────────────┘

   После нажатия:
   ┌────────────────────────────────────────────┐
   │ Добро пожаловать в Горные бегуны! 🎉       │
   │                                            │
   │ Ты теперь участник группы.                 │
   │                                            │
   │ Открой приложение, чтобы увидеть           │
   │ расписание тренировок и записаться.        │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │   🚀 Открыть Горные бегуны в Ayda Run       │
   │         (webapp button)                     │
   └─────────────────────────────────────────────┘

8. ЕСЛИ пользователь УЖЕ СУЩЕСТВУЕТ в БД:

   [Вариант A: Группа внутри клуба]
   ┌────────────────────────────────────────────┐
   │ С возвращением, {firstName}! 👋            │
   │                                            │
   │ Тебя пригласили в группу:                  │
   │                                            │
   │ ┌────────────────────────────────────────┐ │
   │ │ 👥 Горные бегуны                       │ │
   │ │ 25 участников                          │ │
   │ │ Часть клуба: 🏆 SRG Almaty             │ │
   │ │                                        │ │
   │ │ Трейлы по выходным.                   │ │
   │ └────────────────────────────────────────┘ │
   │                                            │
   │ Присоединяешься?                           │
   └────────────────────────────────────────────┘

   [Вариант B: Независимая группа]
   ┌────────────────────────────────────────────┐
   │ С возвращением, {firstName}! 👋            │
   │                                            │
   │ Тебя пригласили в группу:                  │
   │                                            │
   │ ┌────────────────────────────────────────┐ │
   │ │ 👥 Вечерние бегуны                     │ │
   │ │ 15 участников                          │ │
   │ │                                        │ │
   │ │ Бегаем по вечерам в парке.            │ │
   │ └────────────────────────────────────────┘ │
   │                                            │
   │ Присоединяешься?                           │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────┬─────────────────────┐
   │ ✅ Вступить         │ ❌ Не сейчас        │
   └─────────────────────┴─────────────────────┘

9. ЕСЛИ существующий пользователь нажал "Вступить":
   ┌────────────────────────────────────────────┐
   │ Добро пожаловать в Горные бегуны! 🎉       │
   │                                            │
   │ Ты теперь участник группы.                 │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │   🚀 Открыть Горные бегуны в Ayda Run       │
   └─────────────────────────────────────────────┘

10. ЕСЛИ "Не сейчас" (на любом шаге):
   ┌────────────────────────────────────────────┐
   │ Хорошо! Ссылка будет работать,             │
   │ когда решишь присоединиться.               │
   │                                            │
   │ Или можешь посмотреть публичные            │
   │ тренировки в приложении 👇                 │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │         🔍 Посмотреть тренировки            │
   └─────────────────────────────────────────────┘
```

---

## FLOW 3: Организатор клуба

### Сценарий
Пользователь хочет создать клуб в системе. Клуб — это "зонтик" для нескольких групп.

### Важно
На этапе MVP создание клуба проходит через ручную модерацию (beta-режим).

### Алгоритм

```
ШАГИ FLOW 3 (Организатор клуба):

1. Пользователь выбрал "📋 Я организатор" в главном меню

2. Бот отправляет:
   ┌────────────────────────────────────────────┐
   │ Круто, что хочешь организовать             │
   │ спортивное сообщество! 💪                  │
   │                                            │
   │ Что ты хочешь создать?                     │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │ 🏆 Клуб (от 50 человек)                     │
   │ Объединяет несколько групп                  │
   ├─────────────────────────────────────────────┤
   │ 👥 Группу (до 50 человек)                   │
   │ Отдельное сообщество                        │
   ├─────────────────────────────────────────────┤
   │ ← Назад                                     │
   └─────────────────────────────────────────────┘

3. ЕСЛИ выбрал "Клуб":

4. Бот объясняет процесс:
   ┌────────────────────────────────────────────┐
   │ 🏆 Создание клуба                          │
   │                                            │
   │ Клуб — это организация, которая            │
   │ объединяет несколько групп.                │
   │                                            │
   │ Например: Almaty Runners                   │
   │ ├── Утренние пробежки                      │
   │ ├── Вечерний бег                           │
   │ └── Выходные трейлы                        │
   │                                            │
   │ ⚠️ Сейчас создание клубов в бета-режиме.   │
   │ Ты заполнишь форму, и мы свяжемся          │
   │ для настройки.                             │
   │                                            │
   │ Обычно это занимает 1-2 дня.               │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────┬─────────────────────┐
   │ 📝 Заполнить заявку │ ← Назад             │
   └─────────────────────┴─────────────────────┘

5. ЕСЛИ "Заполнить заявку":

6. Бот начинает сбор данных (пошагово):

   ШАГ 6.1 — Название клуба:
   ┌────────────────────────────────────────────┐
   │ Как называется твой клуб?                  │
   │                                            │
   │ Напиши название:                           │
   └────────────────────────────────────────────┘
   
   [Ждём текстовый ответ]
   
   Пользователь: "Almaty Trail Team"

   ШАГ 6.2 — Описание:
   ┌────────────────────────────────────────────┐
   │ 👍 Almaty Trail Team — отличное название!  │
   │                                            │
   │ Теперь напиши краткое описание клуба       │
   │ (1-2 предложения):                         │
   └────────────────────────────────────────────┘
   
   [Ждём текстовый ответ]
   
   Пользователь: "Трейловый клуб Алматы. Горы, приключения, дружба."

   ШАГ 6.3 — Виды спорта:
   ┌────────────────────────────────────────────┐
   │ Какие виды активностей у вас?              │
   │ (выбери все подходящие)                    │
   └────────────────────────────────────────────┘
   
   [Inline keyboard с multi-select:]
   ┌───────────────────┬───────────────────┐
   │ ☐ 🏃 Бег          │ ☐ ⛰️ Трейл        │
   ├───────────────────┼───────────────────┤
   │ ☐ 🥾 Хайкинг      │ ☐ 🚴 Вело         │
   ├───────────────────┴───────────────────┤
   │            ✅ Готово                   │
   └───────────────────────────────────────┘

   ШАГ 6.4 — Количество участников:
   ┌────────────────────────────────────────────┐
   │ Сколько примерно участников в клубе?       │
   │                                            │
   │ Напиши число:                              │
   └────────────────────────────────────────────┘
   
   [Ждём текстовый ответ]
   
   Пользователь: "120"

   ШАГ 6.5 — Количество групп:
   ┌────────────────────────────────────────────┐
   │ Сколько групп внутри клуба?                │
   │                                            │
   │ Например, у вас могут быть разные группы   │
   │ по направлениям или уровню подготовки.     │
   │                                            │
   │ Напиши число (можно примерно):             │
   └────────────────────────────────────────────┘
   
   [Ждём текстовый ответ]
   
   Пользователь: "4"

   ШАГ 6.6 — Telegram группа (опционально):
   ┌────────────────────────────────────────────┐
   │ Хочешь подключить Telegram чат?            │
   │                                            │
   │ Если добавишь нашего бота @ayda_run_v2_bot │
   │ в вашу группу, мы сможем:                  │
   │                                            │
   │ ✨ Автоматически создать клуб с данными    │
   │    из вашего чата                          │
   │ 📢 Отправлять уведомления о тренировках    │
   │ 👥 Синхронизировать участников             │
   │ ✅ Отмечать посещаемость                   │
   │                                            │
   │ Это можно сделать сейчас или позже.        │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │ 🔗 Хочу подключить чат                      │
   ├─────────────────────────────────────────────┤
   │ ⏭ Пока пропустить                          │
   └─────────────────────────────────────────────┘
   
   ЕСЛИ "Хочу подключить чат":
   ┌────────────────────────────────────────────┐
   │ Отлично! Вот что нужно сделать:            │
   │                                            │
   │ 1. Добавь @ayda_run_v2_bot в вашу группу   │
   │ 2. Сделай бота администратором             │
   │ 3. Пришли сюда ссылку на группу            │
   │    (формат: https://t.me/... или @...)     │
   └────────────────────────────────────────────┘
   
   [Ждём ссылку]

   ШАГ 6.7 — Контакт для связи:
   ┌────────────────────────────────────────────┐
   │ Как с тобой лучше связаться?               │
   │                                            │
   │ Я напишу тебе в Telegram (@{username})     │
   │ или укажи другой способ:                   │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │ ✅ Пиши в Telegram                          │
   ├─────────────────────────────────────────────┤
   │ 📱 Указать телефон/WhatsApp                 │
   └─────────────────────────────────────────────┘

7. Бот показывает summary:
   ┌────────────────────────────────────────────┐
   │ 📋 Проверь заявку:                         │
   │                                            │
   │ 🏆 Клуб: Almaty Trail Team                 │
   │ 📝 Описание: Трейловый клуб Алматы.        │
   │    Горы, приключения, дружба.              │
   │ 🏃 Спорт: Трейл, Хайкинг                   │
   │ 👥 Участников: ~120                        │
   │ 📂 Групп: ~4                               │
   │ 💬 Telegram: @almaty_trail_chat            │
   │ 👤 Контакт: @renat_username                │
   │                                            │
   │ Всё верно?                                 │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────┬─────────────────────┐
   │ ✅ Отправить        │ ✏️ Исправить        │
   └─────────────────────┴─────────────────────┘

8. ЕСЛИ "Отправить":
   - Сохраняем заявку в БД со статусом 'pending'
   - Отправляем уведомление админу в ТГ
   - Отправляем confirmation пользователю:
   
   ┌────────────────────────────────────────────┐
   │ Заявка отправлена! 🎉                      │
   │                                            │
   │ Я свяжусь с тобой в течение 1-2 дней       │
   │ для настройки клуба.                       │
   │                                            │
   │ А пока можешь посмотреть как работает      │
   │ приложение:                                │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │         🚀 Открыть Ayda Run                 │
   └─────────────────────────────────────────────┘

9. ЕСЛИ выбрал "Группу" (на шаге 2):
   ┌────────────────────────────────────────────┐
   │ 👥 Создание группы                         │
   │                                            │
   │ Группу можно создать прямо в приложении!   │
   │                                            │
   │ Открой Ayda Run → нажми "+" →              │
   │ выбери "Создать группу"                    │
   └────────────────────────────────────────────┘
   
   [Inline keyboard:]
   ┌─────────────────────────────────────────────┐
   │         🚀 Открыть Ayda Run                 │
   ├─────────────────────────────────────────────┤
   │              ← Назад                        │
   └─────────────────────────────────────────────┘
```

### Уведомление админу (в Telegram)

```
📥 НОВАЯ ЗАЯВКА НА КЛУБ

🏆 Название: Almaty Trail Team
📝 Описание: Трейловый клуб Алматы. Горы, приключения, дружба.
🏃 Спорт: Трейл, Хайкинг
👥 Участников: ~120
📂 Групп: ~4
💬 Telegram группа: @almaty_trail_chat
👤 Заявитель: Ренат (@renat_username)
📅 Дата: 18.12.2025 14:30

[Inline keyboard:]
┌─────────────────────┬─────────────────────┐
│ ✅ Одобрить         │ ❌ Отклонить        │
└─────────────────────┴─────────────────────┘
```

---

## Вспомогательные команды бота

### /help
```
┌────────────────────────────────────────────┐
│ 📖 Команды бота Ayda Run                   │
│                                            │
│ /start — Начать / Главное меню             │
│ /profile — Мой профиль                     │
│ /mygroups — Мои группы и клубы             │
│ /upcoming — Ближайшие тренировки           │
│ /help — Эта справка                        │
│                                            │
│ 💬 Вопросы? Пиши @aydarun_support          │
└────────────────────────────────────────────┘
```

### /profile
```
┌────────────────────────────────────────────┐
│ 👤 Твой профиль                            │
│                                            │
│ Имя: {firstName} {lastName}                │
│ Username: @{username}                      │
│ Участник с: 15 декабря 2025                │
│                                            │
│ 🏆 Клубы: SRG Almaty                       │
│ 👥 Группы: Вечерние бегуны, Горные бегуны  │
│ 📅 Посещено тренировок: 12                 │
│                                            │
│ [Открыть полный профиль в приложении]      │
└────────────────────────────────────────────┘
```

### /mygroups
```
┌────────────────────────────────────────────┐
│ 📋 Твои группы и клубы                     │
│                                            │
│ 🏆 SRG Almaty (участник)                   │
│ 👥 Вечерние бегуны (организатор)           │
│ 👥 Горные бегуны (участник)                │
│                                            │
│ [Управлять в приложении]                   │
└────────────────────────────────────────────┘
```

---

## Примеры сообщений об ошибках

```
# Клуб/группа не найдены
┌────────────────────────────────────────────┐
│ ❌ Упс! Не могу найти этот клуб.           │
│                                            │
│ Возможно, ссылка устарела или              │
│ клуб был удалён.                           │
│                                            │
│ Попробуй запросить новую ссылку            │
│ у организатора.                            │
└────────────────────────────────────────────┘

# Неверный формат ссылки
┌────────────────────────────────────────────┐
│ ❌ Не могу распознать ссылку.              │
│                                            │
│ Формат: https://t.me/... или @...          │
│ Попробуй ещё раз.                          │
└────────────────────────────────────────────┘

# Уже участник
┌────────────────────────────────────────────┐
│ 👋 Ты уже участник этой группы!            │
│                                            │
│ Открой приложение, чтобы посмотреть        │
│ расписание тренировок.                     │
└────────────────────────────────────────────┘
```

---

## Чеклист реализации

### Flow 1: Участник самостоятельно
- [ ] Обработка /start без параметров
- [ ] Проверка существующего пользователя
- [ ] Приветственное сообщение с выбором роли
- [ ] Запрос согласия на использование данных ТГ
- [ ] Выбор видов активностей (multi-select)
- [ ] Интро по приложению с картинкой
- [ ] Success экран с кнопкой Mini App

### Flow 2A: Приглашение в клуб
- [ ] Парсинг deep link параметров клуба
- [ ] Получение preview данных клуба
- [ ] Комбинированное приветствие (приложение + клуб)
- [ ] Выбор активностей для новых пользователей
- [ ] Интро по приложению
- [ ] Короткий flow для существующих пользователей

### Flow 2B: Приглашение в группу
- [ ] Парсинг deep link параметров группы
- [ ] Получение preview данных группы (+ клуба если есть)
- [ ] Комбинированное приветствие (приложение + группа)
- [ ] Выбор активностей для новых пользователей
- [ ] Интро по приложению
- [ ] Короткий flow для существующих пользователей

### Flow 3: Организатор клуба
- [ ] Меню выбора "клуб / группа" с рекомендациями по размеру
- [ ] Пошаговый сбор данных (name, description, sports, members count, groups count, telegram, contact)
- [ ] Multi-select для видов спорта
- [ ] Объяснение преимуществ подключения Telegram чата
- [ ] Summary перед отправкой
- [ ] Уведомление админу в Telegram
- [ ] Редирект на создание группы в приложении

### Общее
- [ ] Обработка неожиданных сообщений
- [ ] Кнопка "Назад" на каждом шаге
- [ ] Картинки для интро по приложению

---

*Документ создан: 18 декабря 2025*
*Версия: 2.0*
